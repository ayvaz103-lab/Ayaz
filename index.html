<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IPTV Smart Player</title>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
<style>
body{margin:0;background:#0a0a0a;color:#fff;font-family:Arial}
header{padding:15px;text-align:center;font-size:22px;color:#e50914}
#search{width:100%;padding:12px;border:none;background:#1a1a1a;color:#fff}
.list{padding:10px}
.item{padding:12px;margin-bottom:8px;background:#151515;border-left:4px solid #e50914;cursor:pointer;border-radius:6px}
.item:hover{background:#222}
video{width:100%;aspect-ratio:16/9;background:#000;position:sticky;top:0}
.loading{text-align:center;padding:20px}
</style>
</head>
<body>

<header>SMART IPTV PLAYER</header>

<video id="video" controls autoplay></video>

<input id="search" placeholder="Kanal Ara..." onkeyup="filterList(this.value)">

<div class="list" id="list">
<div class="loading">Liste yükleniyor...</div>
</div>

<script>
const m3uUrl = "http://kingplayer.one:80/get.php?username=XXX&password=YYY&type=m3u&output=m3u8";
const proxy = "https://api.allorigins.win/raw?url=";
let channels = [];
let hls;

async function loadM3U() {
    try {
        const res = await fetch(proxy + encodeURIComponent(m3uUrl));
        const text = await res.text();
        parseM3U(text);
    } catch(e) {
        document.getElementById("list").innerHTML = "Liste yüklenemedi (CORS veya HTTP engeli).";
    }
}

function parseM3U(data){
    channels = [];
    const lines = data.split("\n");
    for(let i=0;i<lines.length;i++){
        if(lines[i].startsWith("#EXTINF")){
            const name = lines[i].split(",")[1] || "Kanal";
            const url = lines[i+1]?.trim();
            if(url && url.startsWith("http")){
                channels.push({name,url});
            }
        }
    }
    renderList(channels);
}

function renderList(data){
    const list = document.getElementById("list");
    list.innerHTML = "";
    data.forEach(ch=>{
        const div = document.createElement("div");
        div.className="item";
        div.innerText=ch.name;
        div.onclick=()=>play(ch.url);
        list.appendChild(div);
    });
}

function play(url){
    const video = document.getElementById("video");
    if(Hls.isSupported()){
        if(hls) hls.destroy();
        hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);
    }else{
        video.src = url;
    }
}

function filterList(val){
    const filtered = channels.filter(c=>c.name.toLowerCase().includes(val.toLowerCase()));
    renderList(filtered);
}

loadM3U();
</script>

</body>
</html>
